
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Sign2Pay Documentation</title>

    <link href="stylesheets/font-awesome.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="stylesheets/screen.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="stylesheets/print.css" media="print" rel="stylesheet" type="text/css" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="javascripts/all.js" type="text/javascript"></script>

    <script>
      $(function() {
        var toc = $("#toc").tocify({
          selectors: "h1,h2",
          extendPage: false,
          theme: "none",
          smoothScroll: false,
          showEffectSpeed: 0,
          hideEffectSpeed: 180,
          ignoreSelector: ".toc-ignore",
          hashGenerator: 'pretty',
          highlightOffset: 60,
          scrollTo: -2,
          scrollHistory: true,
          hashGenerator: function(text, element) {
            return element[0].getAttribute('id');
          }
        }).data("toc-tocify");
        // Hack to make already open sections to start opened,
        // instead of displaying an ugly animation
        setTimeout(function() {
          toc.setOption("showEffectSpeed", 180);
        },50);
        setupLanguages([
          
        ]);
      });
    </script>
  </head>

  <body class="index">
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
      <div id="toc">
      </div>
      
      <ul class="toc-footer">
        
          <li><a href='mailto:nicolas@sign2pay.com'>Get a Merchant App Setup</a></li>
        
          <li><a href='http://github.com/tripit/slate'>Documentation Powered by Slate</a></li>
        
      </ul>
      
    </div>
    <div class="page-wrapper">
      <div class="content">
        <h1 id="introduction">Introduction</h1>

<p>Welcome to Sign2Pay! This should be seen as an organic document as we are still flushing out some of the details. If any of your questions aren&rsquo;t answered here, <a href='mailto:nicolas@sign2pay.com'>reach out</a> and we&rsquo;ll be happy to help!</p>

<h1 id="integration-overview">Integration Overview</h1>

<p>Sign2Pay integrates into your checkout process by first setting a few variables and including the sign2pay.js script withing your checkout flow. Our script handles all of the passing of data to our API via secure POST over https. Responses from the API are listened for by a hidden iframe that is generated by out script which deals with message and error handling.</p>

<p>The second requirement of integrating the full S2P payment solution includes providing us with a secure Postback URL. This Postback URL is hosted in your own environment and is used to listen for Payment Notifications and perform updates to your backend.</p>

<h1 id="key-concepts">Key Concepts</h1>

<h2 id="risk-assessment">Risk Assessment</h2>

<p>Sign2Pay provides you a frictionless method for your users to make a mobile payment using their IBAN and a signature. One of the reasons we guarantee these payments is because we have already built a consumer profile, and run our above industry standard Risk Assessment, before the S2P Payment Method is even presented to the user.</p>

<h2 id="sign2pay">Sign2Pay</h2>

<p>If the risk score from our Risk Assessment allows for it, the user can then opt to Sign2Pay. This entails adding their IBAN, and providing us a signature.</p>

<h2 id="postback">Postback</h2>

<p>Once this step has passed validation and the official SEPA mandate has been created on our side, we will send a secure POST to the Postback URL you provided during your Merchant Intake process to indicate the successful payment.</p>

<h2 id="redirect">Redirect</h2>

<p>The user is then redirected to the URL of your choice along with any parameters your site needs to finalize your process.</p>

<h1 id="applications">Applications</h1>

<p>Currently, the Merchant Intake is a manual process. This gives us a chance to get to know you and make sure you are getting the best support possible. Once this process is complete, we&rsquo;ll create your S2P account, and an initial Sign2Pay Merchant App.</p>

<h3 id="merchant-id">Merchant ID</h3>

<p>Your Merchant ID is the id of your S2P account and is required for integration of the sign2pay.js. This will be supplied to you as soon as you are setup. As S2P is backed by MongoDB, this is a simple alpha-numeric Mongo _id string.</p>

<h3 id="token">Token</h3>

<p>The application token identifies your application to our API and is required for integration of the sign2pay.js.</p>

<p><aside class="success">
  If needed, you can request additonal apps based on production vs. staging, or if you have multiple properties to integrate with.
</aside></p>

<h2 id="s2p-application-settings">S2P Application Settings</h2>

<p>The following information will be requested during the Merchant Intake process for each S2P application you&rsquo;d like setup.</p>

<h3 id="implementation-url">Implementation URL</h3>

<p>This is the full URI including protocol, from which API requests will be made.</p>

<p>For example:
<code class="prettyprint">https://www.example.com/checkout/orders/12345</code></p>

<p>Currently, the same goes for integrating via the *S2P iOS Library.</p>

<h3 id="postback-url">Postback URL</h3>

<p>This is the complete URL that our backend will send a POST to once we have collected all payment details, and have authorized the transaction.</p>

<p>For example:
<code class="prettyprint">https://api.example.com/checkout/postback</code></p>

<p>Check <a href='#the-postback'>Postback</a> for full details.</p>

<h3 id="mode">Mode</h3>

<p>If your application is in test mode, no payments will be processed associated with this application token. The Risk Assessment and Signature verification will however function as normal.</p>

<h1 id="sign2pay-ios-library">Sign2Pay iOS Library</h1>

<p>The Sign2Pay iOS SDK simplifies 3 tasks:</p>

<ol>
<li>authorize access and usage to the Sign 2 Pay API service</li>
<li>running <a href="#risk-assessment">risk assessments</a></li>
<li>present the Sign 2 Pay overlay to kick of the payment process</li>
</ol>

<p><aside class="notice">
  We are supporting iOS 7 and up.
</aside></p>

<h2 id="installation">Installation</h2>

<blockquote>
<p>Targets &gt; Your App &gt; Build Phases &gt; Link Binary With Libraries.</p>
</blockquote>

<p>Download our library and include it in Link Binary With Libraries.</p>

<h2 id="usage">Usage</h2>
<pre class="highlight objective_c"><span class="n">S2PSDK</span>
<span class="o">======</span>

<span class="k">@interface</span> <span class="nc">S2PSDK</span> <span class="p">:</span> <span class="nc">NSObject</span>

<span class="k">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>   <span class="nf">init</span><span class="p">:(</span><span class="n">S2PConfiguration</span> <span class="o">*</span><span class="p">)</span><span class="nv">configuration</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">assessRiskForTransaction</span><span class="p">:(</span><span class="n">S2PTransaction</span> <span class="o">*</span><span class="p">)</span><span class="nv">transaction</span> <span class="nf">withCompletion</span><span class="p">:(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">S2PResponse</span> <span class="o">*</span><span class="n">response</span><span class="p">,</span> <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">))</span><span class="nv">completion</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">sign2payFromViewController</span><span class="p">:(</span><span class="n">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">presentingViewController</span><span class="p">;</span>

<span class="k">@end</span>

</pre>
<p>The <code class="prettyprint">S2PSDK</code> class provides 3 important public methods.
Each method corresponds to a step in the Sign 2 Pay flow.</p>

<table><thead>
<tr>
<th>Authorize</th>
<th>Risk Assessment</th>
<th>Payment</th>
</tr>
</thead><tbody>
<tr>
<td>init:</td>
<td>assessRiskForTransaction:error:</td>
<td>sign2payFromViewController:</td>
</tr>
</tbody></table>

<p>Your app should not show the Sign 2 Pay button until the SDK returns a valid risk assessment.
This means you will run at least one succesfull risk assessment and evaluate it&rsquo;s
response type.  If the response type allows a Sign 2 Pay payment you can show the relevant button.</p>

<h3 id="there-are-a-couple-of-helper-classes-that-are-important:">There are a couple of helper classes that are important:</h3>
<pre class="highlight objective_c"><span class="n">S2PConfiguration</span>
<span class="o">================</span>

<span class="k">@interface</span> <span class="nc">S2PConfiguration</span> <span class="p">:</span> <span class="nc">NSObject</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">merchantId</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">implementationURL</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">copy</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">applicationToken</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="nf">initWithMerchantId</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">merchantId</span> <span class="nf">implementationURL</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">referalURL</span> <span class="nf">applicationToken</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">applicationToken</span><span class="p">;</span>

<span class="k">@end</span>
</pre>
<ul>
<li><code class="prettyprint">S2PConfiguration</code>:<br>helps you setting up your credentials with <code class="prettyprint">[S2PSDK init:]</code>.</li>
</ul>
<pre class="highlight objective_c"><span class="n">S2PTransaction</span>
<span class="o">==============</span>

<span class="k">@interface</span> <span class="nc">S2PTransaction</span> <span class="p">:</span> <span class="nc">NSObject</span>

<span class="n">NSString</span> <span class="o">*</span><span class="n">firstName</span><span class="p">;</span>
<span class="n">NSString</span> <span class="o">*</span><span class="n">lastName</span><span class="p">;</span>
<span class="n">NSString</span> <span class="o">*</span><span class="n">email</span><span class="p">;</span>        <span class="c1">// for transactional emails
</span><span class="n">NSString</span> <span class="o">*</span><span class="n">address</span><span class="p">;</span>
<span class="n">NSString</span> <span class="o">*</span><span class="n">postalCode</span><span class="p">;</span>
<span class="n">NSString</span> <span class="o">*</span><span class="n">city</span><span class="p">;</span>
<span class="n">NSString</span> <span class="o">*</span><span class="n">region</span><span class="p">;</span>
<span class="n">NSString</span> <span class="o">*</span><span class="n">country</span><span class="p">;</span>      <span class="c1">// iso code
</span><span class="n">NSNumber</span> <span class="o">*</span><span class="n">amount</span><span class="p">;</span>       <span class="c1">// in cents, no points or other delimeters
</span><span class="n">NSString</span> <span class="o">*</span><span class="n">referenceId</span><span class="p">;</span>  <span class="c1">// your shopping cart reference
</span>
<span class="c1">// init an S2PTransaction with a provided camelCased dict and error
</span><span class="k">+</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span> <span class="nf">transactionWithDictionary</span><span class="p">:(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">dictionary</span> <span class="nf">error</span><span class="p">:(</span><span class="n">NSError</span> <span class="o">*</span> <span class="n">__autoreleasing</span> <span class="o">*</span><span class="p">)</span><span class="nv">error</span><span class="p">;</span>

<span class="k">@end</span>

</pre><pre class="highlight objective_c"><span class="n">S2PResponseType</span>
<span class="o">===============</span>

<span class="c1">// the possible values of an S2PResponse type property
</span>
<span class="k">typedef</span> <span class="n">NS_ENUM</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">,</span> <span class="n">S2PResponseType</span><span class="p">){</span>
    <span class="n">S2PResponseTypeNil</span><span class="p">,</span>
    <span class="n">S2PResponseTypeDenied</span><span class="p">,</span>
    <span class="n">S2PResponseTypeFailure</span><span class="p">,</span>
    <span class="n">S2PResponseTypeAllowed</span><span class="p">,</span>
    <span class="n">S2PResponseTypeExpand</span><span class="p">,</span>
    <span class="n">S2PResponseTypeProcessing</span><span class="p">,</span>
    <span class="n">S2PResponseTypeRedirect</span><span class="p">,</span>
    <span class="n">S2PResponseTypeCount</span>
<span class="p">};</span>
</pre>
<ul>
<li><code class="prettyprint">S2PTransaction</code>: <br>
used in combination with <code class="prettyprint">[S2PSDK assessRiskForTransaction:error:]</code></li>
</ul>

<h3 id="authorization">Authorization</h3>
<pre class="highlight objective_c"><span class="c1">// init the sdk in e.g. your app delegate
</span>
<span class="cp">#import "S2PSDK.h"
</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="n">setupSign2Pay</span>
<span class="p">{</span>
    <span class="n">S2PConfiguration</span> <span class="o">*</span><span class="n">configuration</span><span class="p">;</span>

    <span class="c1">// Replace the values with your personal credentials.
</span>    <span class="c1">// You can find them in your dashboard.
</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">merchantId</span>        <span class="o">=</span> <span class="s">@"e87654b84e6963064d000000"</span><span class="p">;</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">implementationURL</span> <span class="o">=</span> <span class="s">@"http://my.eshopexperience.com/checkout"</span><span class="p">;</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">token</span>             <span class="o">=</span> <span class="s">@"67ewbc135370611247020000"</span><span class="p">;</span>

    <span class="n">configuration</span> <span class="o">=</span> <span class="p">[[</span><span class="n">S2PConfiguration</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithMerchantId</span><span class="p">:</span> <span class="n">merchantId</span>
                                               <span class="nf">implementationURL</span><span class="p">:</span> <span class="n">implementationURL</span>
                                                <span class="nf">applicationToken</span><span class="p">:</span> <span class="n">token</span> <span class="p">];</span>

    <span class="n">sign2pay</span> <span class="o">=</span> <span class="p">[[</span><span class="n">S2PSDK</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">:</span><span class="n">configuration</span><span class="p">];</span>
<span class="p">}</span>
</pre>
<p>Your app needs authorization in order to use Sign 2 Pay&rsquo;s risk assessment service
and payments later on.</p>

<p>The SDK provides a <code class="prettyprint">S2PConfiguration</code> class to make this process as easy as possible.
Initialize an instance of <code class="prettyprint">S2PConfiguration</code> with your personal credentials.</p>

<p><code class="prettyprint">[S2PSDK init:]</code> does not trigger a web request.<br>
It just sets the necessary information on the <code class="prettyprint">S2PSDK</code> instance.</p>

<h3 id="risk-assessments">Risk Assessments</h3>
<pre class="highlight objective_c"><span class="cm">/*

S2PTransaction
---------------
example usage:

create a transaction object with the information collected
from the current user

*/</span>

<span class="n">NSError</span> <span class="o">*</span><span class="n">transactionError</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>

<span class="c1">// no network request is made at this point
</span><span class="n">S2PTransaction</span> <span class="o">*</span><span class="n">transaction</span> <span class="o">=</span> <span class="p">[</span><span class="n">S2PTransaction</span> <span class="nf">transactionWithDictionary</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">formDictionary</span> <span class="nf">error</span><span class="p">:</span><span class="o">&amp;</span><span class="n">transactionError</span><span class="p">];</span>

<span class="k">if</span><span class="p">(</span> <span class="n">transactionError</span> <span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// handle error
</span>  <span class="c1">// at this point you'll get a hardcoded error stating the email address was not provided
</span>  <span class="c1">// better error messages are in the making
</span><span class="p">}</span>

</pre>
<p>You should trigger a risk assesment any time you can provide the API with an updated, valid form.
The assessment runs on a background thread and should not block your UI.
You need an instance of <code class="prettyprint">S2PSDK</code> and an instance of <code class="prettyprint">S2PTransaction</code> in order to trigger an assessment.</p>

<p>You can pass in a valid <code class="prettyprint">S2PTransaction</code> when using <code class="prettyprint">S2PSDK</code>&rsquo;s <code class="prettyprint">assessRiskForTransaction:withCompletion</code> method.
You can create an instance of a transaction by providing an <code class="prettyprint">NSDictionary</code>
that holds appropriately named keys with their values to the <code class="prettyprint">transactionWithDictionary:error:</code> method.</p>

<ul>
<li>firstName</li>
<li>lastName</li>
<li>email</li>
<li>address</li>
<li>postalCode</li>
<li>city</li>
<li>region</li>
<li>country</li>
<li>amoun</li>
<li>referenceId</li>
</ul>

<p><code class="prettyprint">S2PTransaction *transaction =
[S2PTransaction transactionWithDictionary:self.formDictionary error:&amp;transactionError];</code></p>

<p><code class="prettyprint">[[s2pSDK assessRiskForTransaction:transaction withCompletion:^(S2PResponse *response, NSError *error) { ... }];</code></p>

<p>You can evaluate <code class="prettyprint">response.type</code> inside that completion block.</p>

<p>These are the possible response types:
<code class="prettyprint">S2PResponseTypeNil,S2PResponseTypeDenied,S2PResponseTypeFailure,S2PResponseTypeProcessing,S2PResponseTypeRedirect,S2PResponseTypeCount</code></p>

<h3 id="sign-2-pay-overlay">Sign 2 Pay overlay</h3>

<p>Once the risk assessment allows the use of Sign 2 Pay as payment provider you can present your own custom &ldquo;Pay with Sign2Pay&rdquo; button.
When the user clicks the button the SDK can present the Sign 2 Pay overlay which will take care of the payment process.</p>

<p><code class="prettyprint">[s2pSDK sign2payFromViewController:self];</code></p>

<p>You can listen for notifications in order to anticipate the closing of the Sign 2 Pay viewcontroller.
The SDK provides access to <code class="prettyprint">const</code> values to minimize typos:
- <code class="prettyprint">kS2PWillCloseS2PPaymentViewController</code>
- <code class="prettyprint">kS2PDidCloseS2PPaymentViewController</code></p>

<p>When one of these notifications comes in, the <code class="prettyprint">object</code> property
contains a <code class="prettyprint">S2PResponseType</code> value.</p>

<p>If the value is equal to <code class="prettyprint">S2PResponseTypeRedirect</code> the payment was successful.
In all other cases the payment was not successful.</p>

<p>The possible values of the other <code class="prettyprint">S2PResponseType</code>s you can receive should be self explanatory.</p>

<h1 id="sign2pay.js">Sign2Pay.js</h1>

<p>Integrating Sign2Pay into your checkout page is similar to adding Google Analytics to your page. It involves setting up access to a few variables, and including the script that will add the sign2pay.js to your page asynchronously.</p>

<p>There are a few ways to integrate Sign2Pay into your site/application. How your checkout process works will determine the method you&rsquo;ll use.</p>

<h2 id="single-page-checkout">Single Page Checkout</h2>

<blockquote>
<p>This can be included anywhere in your page, just don&rsquo;t forget to wrap in a <code class="prettyprint">&lt;script&gt;</code> tag.</p>
</blockquote>
<pre class="highlight javascript">
  <span class="nb">window</span><span class="p">.</span><span class="nx">sign2PayOptions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">merchant_id</span><span class="p">:</span> <span class="s1">'e29550b84e6963064d000000'</span><span class="p">,</span>
    <span class="na">token</span><span class="p">:</span> <span class="s1">'52fa46da537061f622000000'</span><span class="p">,</span>
    <span class="na">checkout_type</span><span class="p">:</span> <span class="s1">'single'</span><span class="p">,</span>
    <span class="na">domain</span> <span class="p">:</span> <span class="s2">"sign2pay.com"</span><span class="p">,</span>
    <span class="na">map</span><span class="p">:{</span>
      <span class="na">first_name</span><span class="p">:</span> <span class="s1">'#consumer_first_name'</span><span class="p">,</span>
      <span class="na">last_name</span><span class="p">:</span> <span class="s1">'#consumer_last_name'</span><span class="p">,</span>
      <span class="na">email</span><span class="p">:</span> <span class="s1">'#consumer_email'</span><span class="p">,</span>
      <span class="na">address</span><span class="p">:</span> <span class="s1">'#consumer_address'</span><span class="p">,</span>
      <span class="na">postal_code</span><span class="p">:</span> <span class="s1">'#consumer_postal_code'</span><span class="p">,</span>
      <span class="na">city</span><span class="p">:</span> <span class="s1">'#consumer_city'</span><span class="p">,</span>
      <span class="na">region</span><span class="p">:</span> <span class="s1">'#consumer_region'</span><span class="p">,</span>
      <span class="na">country</span><span class="p">:</span> <span class="s1">'#consumer_country'</span><span class="p">,</span>
      <span class="na">amount</span><span class="p">:</span> <span class="s1">'#consumer_amount'</span><span class="p">,</span>
      <span class="na">ref_id</span> <span class="p">:</span> <span class="s1">'#order_id'</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"script"</span><span class="p">);</span>
    <span class="nx">s</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s2">"text/javascript"</span><span class="p">;</span>
    <span class="nx">s</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">"//sign2pay.com/assets/merchant.js"</span><span class="p">;</span>
    <span class="nx">s</span><span class="p">.</span><span class="nx">async</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">t</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'script'</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">t</span><span class="p">);</span>
  <span class="p">})();</span>

</pre>
<blockquote>
<p><code class="prettyprint">amount</code> is provided as <strong>cents</strong>.</p>
</blockquote>

<p>You&rsquo;ll use the Single Page integration if:</p>

<ul>
<li>your users enter their contact and shipping details on the same page they will select a payment method from.</li>
</ul>

<p><strong>or</strong></p>

<ul>
<li>returning users do not enter shipping information as it is already saved in their account info.</li>
</ul>

<p><strong>and</strong></p>

<ul>
<li>all required variables can be populated by parsing the DOM or calcuated via js function.</li>
</ul>

<h3 id="the-map-object">The Map Object</h3>

<p>The <code class="prettyprint">map</code> object within <code class="prettyprint">sign2PayOptions</code> provides the means for us to parse your page for values either by providing css selectors OR if a js function is provided, we&rsquo;ll call it and use the return value. The function approach is useful say if your site/application stores the amount in euros.</p>

<p>We continuously &lsquo;watch&rsquo; your page using the map until the required params have been populated, at which point, the Sign2Pay Risk Assessment is initiated.</p>

<p>It should be noted that if any of the params are changed after a Risk Assessment has been run, a new one will be initiated using the new param value(s). Ie. if a user changes their email address or your site/application updates the amount based on shipping method, we&rsquo;ll kick off a new Risk Assessment.</p>

<p><aside class="warning">
  <code class="prettyprint">amount</code> should always be provided as <strong>cents</strong>.
</aside></p>

<h2 id="multi-page-checkout">Multi Page Checkout</h2>

<blockquote>
<p>All values shown as &lsquo;&lt;example&gt;&rsquo; should be replaced as strings except <code class="prettyprint">amount</code>, which is a number representing the amount in <strong>cents</strong>.</p>
</blockquote>
<pre class="highlight javascript">  <span class="nb">window</span><span class="p">.</span><span class="nx">sign2PayOptions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">merchant_id</span><span class="p">:</span> <span class="s1">'e29550b84e6963064d000000'</span><span class="p">,</span>
    <span class="na">token</span><span class="p">:</span> <span class="s1">'52fa46da537061f622000000'</span><span class="p">,</span>
    <span class="na">checkout_type</span><span class="p">:</span> <span class="s1">'multi'</span><span class="p">,</span>
    <span class="na">domain</span> <span class="p">:</span> <span class="s2">"sign2pay.com"</span><span class="p">,</span>
    <span class="na">first_name</span><span class="p">:</span> <span class="s2">"&lt;first_name&gt;"</span><span class="p">,</span>
    <span class="na">last_name</span><span class="p">:</span> <span class="s2">"&lt;last_name&gt;"</span><span class="p">,</span>
    <span class="na">email</span><span class="p">:</span> <span class="s2">"&lt;email&gt;"</span><span class="p">,</span>
    <span class="na">address</span><span class="p">:</span> <span class="s2">"&lt;address&gt;"</span><span class="p">,</span>
    <span class="na">postal_code</span><span class="p">:</span> <span class="s2">"&lt;postal_code&gt;"</span><span class="p">,</span>
    <span class="na">city</span><span class="p">:</span> <span class="s2">"&lt;city&gt;"</span><span class="p">,</span>
    <span class="na">region</span><span class="p">:</span> <span class="s2">"&lt;region&gt;"</span><span class="p">,</span>
    <span class="na">country</span><span class="p">:</span> <span class="s2">"&lt;country&gt;"</span><span class="p">,</span>
    <span class="na">amount</span><span class="p">:</span><span class="o">&lt;</span><span class="nx">amount</span> <span class="k">in</span> <span class="nx">cents</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="na">ref_id</span> <span class="p">:</span> <span class="s2">"&lt;your order id&gt;"</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"script"</span><span class="p">);</span>
    <span class="nx">s</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s2">"text/javascript"</span><span class="p">;</span>
    <span class="nx">s</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">"//sign2pay.com/assets/merchant.js"</span><span class="p">;</span>
    <span class="nx">s</span><span class="p">.</span><span class="nx">async</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">t</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'script'</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
    <span class="nx">t</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">t</span><span class="p">);</span>
  <span class="p">})();</span>
</pre>
<p>You&rsquo;ll use the Multi Page integration if:</p>

<ul>
<li>the user&rsquo;s contact and shipping information has already been entered before they are sent to a seperate payment method page.</li>
</ul>

<p><strong>and</strong></p>

<ul>
<li>you prefer to provide all of the required params within the window.sign2PayOptions object instead of adding hidden inputs to your markup.</li>
</ul>

<p>The Multi Page intergration looks similar to the Single Page one, however, each of the required param&rsquo;s values are set rather than supplying a map to retrive them.</p>

<h2 id="on-demand">On Demand</h2>
<pre class="highlight javascript"><span class="nx">jQuery</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">mySleep</span><span class="o">=</span><span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">sleep</span><span class="p">()},</span><span class="mi">3000</span><span class="p">);</span>

    <span class="kd">function</span> <span class="nx">sleep</span><span class="p">(){</span>
      <span class="k">if</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">s2p</span><span class="p">)</span> <span class="o">!==</span> <span class="s2">"undefined"</span> <span class="p">){</span>

        <span class="nb">window</span><span class="p">.</span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">mySleep</span><span class="p">);</span>

        <span class="nb">window</span><span class="p">.</span><span class="nx">sign2PayOptions</span> <span class="o">=</span> <span class="p">{</span>
          <span class="na">merchant_id</span><span class="p">:</span> <span class="s2">"e29550b84e6963064d000000"</span><span class="p">,</span>
          <span class="na">token</span><span class="p">:</span> <span class="s2">"52fa46da537061f622000000"</span><span class="p">,</span>
          <span class="na">address</span><span class="p">:</span> <span class="s2">"Any Street 53"</span><span class="p">,</span>
          <span class="na">amount</span><span class="p">:</span> <span class="mi">1780</span><span class="p">,</span>
          <span class="na">checkout_type</span><span class="p">:</span> <span class="s2">"single"</span><span class="p">,</span>
          <span class="na">city</span><span class="p">:</span> <span class="s2">"Anytown"</span><span class="p">,</span>
          <span class="na">country</span><span class="p">:</span> <span class="s2">"BE"</span><span class="p">,</span>
          <span class="na">domain</span><span class="p">:</span> <span class="s2">"sign2pay.com"</span><span class="p">,</span>
          <span class="na">email</span><span class="p">:</span> <span class="s2">"example@gmail.com"</span><span class="p">,</span>
          <span class="na">first_name</span><span class="p">:</span> <span class="s2">"Pink"</span><span class="p">,</span>
          <span class="na">last_name</span><span class="p">:</span> <span class="s2">"Floyd"</span><span class="p">,</span>
          <span class="na">postal_code</span><span class="p">:</span> <span class="s2">"2018"</span><span class="p">,</span>
          <span class="na">ref_id</span><span class="p">:</span> <span class="s2">"b133441981683b86"</span>
        <span class="p">};</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">s2p</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">initTransport</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">})();</span>
<span class="p">});</span>
</pre>
<p>If you want/need control over when to initiate the Sign2Pay Risk Assessment, it is possible to call it from your own js, providing that all required param values are available.</p>

<p>In this scenario, you include the asynchronous script as usual, but without providing the <code class="prettyprint">window.sign2payOptions</code> object. When you have all of the required data, simply create the <code class="prettyprint">window.sign2payOptions</code>, and call <code class="prettyprint">window.s2p.options.initTransport();</code>.</p>

<p>To ensure the sign2pay.js has completed loading and the s2p namespace is available for use, it&rsquo;s wise to wrap this call within an interval. An example of how you might approach this is shown on the right.</p>

<h1 id="risk-assessment">Risk Assessment</h1>

<p>As soon as the sign2pay.js has all of the required variables, a Risk Assessment is initiated in the background. The result of the Risk Assessment will determine whether or not the Sign2Pay Payment Method will be offered to the current user.</p>

<p>On our end, by using a range machine learning techniques, including behaviour analysis and predictive modeling, we assess the risk of the proposed transaction is realtime. In additon, the detail of the transaction must pass through several validation checkpoints that ensure your protection from fraudulent or abusive behaviour.</p>

<p>If the Risk Assessment returns an acceptable score, the Sign2Pay Payment Method option will appear amongst your payment options.</p>

<p>If the Risk Assessment denies the transaction, depending on the reason, the Sign2Pay option may be displayed, but disabled depending on the reason for denial.</p>

<h1 id="sign2pay">Sign2Pay</h1>

<p>If your consumer is a first time Sign2Pay user, they will be presented with the S2P overlay requesting their IBAN account. This overlay is sandboxed from your checkout page within a secure iFrame that sits on top of your checkout page, and can be cancelled at any time.</p>

<h2 id="iban">IBAN</h2>

<p>Your consumer&rsquo;s IBAN is validated on several levels. Once validated, we perform a lookup of the issuing bank, it&rsquo;s address, and the matching BIC which gets cached with their account info.</p>

<p>If this is a returning consumer, we have a valid IBAN attached to their S2P account, and their account has been verified, the user will be presented the signature overlay directly with the opportunity to change the IBAN they wish to use.</p>

<h2 id="signature">Signature</h2>

<p>The signature of a first time consumer is stored to their S2P account which will later need to be verified before being able to process any further transactions via Sign2Pay.</p>

<p>For a returning consumer, their signature is compared to those we have on file across a 4 tier algorythm to determine it&rsquo;s authenticity. To find out more about the comparison and validation process, <a href='mailto:nicolas@sign2pay.com'>ask us</a>!</p>

<h1 id="the-postback">The Postback</h1>

<p>Once we&rsquo;ve collected all of the required data and signature for a valid SEPA mandate, we&rsquo;ll perform a serverside POST to the URL you provided during your Merchant Intake process so that you can update your backend accordingly.</p>

<h2 id="post">POST</h2>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>merchant_id</td>
<td>string</td>
<td>your S2P Merchant ID</td>
</tr>
<tr>
<td>purchase_id</td>
<td>string</td>
<td>the S2P ID of this transaction</td>
</tr>
<tr>
<td>ref_id</td>
<td>string</td>
<td>your internal reference ID to retrieve the order</td>
</tr>
<tr>
<td>amount</td>
<td>number</td>
<td>the purchase amount in <strong>cents</strong></td>
</tr>
<tr>
<td>status</td>
<td>string</td>
<td>&ldquo;mandate_valid&rdquo; indicates you will receive payment</td>
</tr>
<tr>
<td>checksum</td>
<td>string</td>
<td>*a valid checksum to ensure the authenticity of the POST</td>
</tr>
</tbody></table>

<p><aside class="notice">
  *You will receive instructions on how to validate the incoming checksum upon completion of the Merchant intake process.
</aside></p>

<h2 id="response">Response</h2>

<p>After validating the authenticity of the POST request, you may want to update your order record status as paid (or whatever your internal process is). Once this is complete, a response is required for use to redirect your consumer appropriately.</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>status</td>
<td>string</td>
<td>&ldquo;success&rdquo; or &ldquo;failed&rdquo;</td>
</tr>
<tr>
<td>redirect_to</td>
<td>string</td>
<td>the URL the consumer should be redirected to</td>
</tr>
<tr>
<td>params</td>
<td>string</td>
<td>any additonal params you would like passed to your redirect_url (ie.: authorization_code, user_message etc)</td>
</tr>
</tbody></table>

<p><aside class="notice">
  We&rsquo;re looking for a JSON response here.
</aside></p>

<h2 id="redirect">Redirect</h2>

<p>When the Postback process is complete, your consumer will be directed to the url provided in the postback response with any params you&rsquo;ve returned appended to the query string.</p>

<p>This is a bit different if you are using the S2P iOS Library as we instead broadcast an event your app can listen for.</p>

<h1 id="errors">Errors</h1>

<p>The S2P API uses the following error codes:</p>

<table><thead>
<tr>
<th>Error Code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td>Bad Request</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden</td>
</tr>
<tr>
<td>404</td>
<td>Not Found</td>
</tr>
<tr>
<td>405</td>
<td>Method Not Allowed</td>
</tr>
<tr>
<td>406</td>
<td>Not Acceptable</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error &ndash; We had a problem with our server. Try again later.</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable &ndash; We&rsquo;re temporarily offline for maintenance. Please try again later.</td>
</tr>
</tbody></table>

<p><aside class="warning">
  The error section of this document is still in the works and should be considered incomplete. If you are having any trouble, <a href='mailto:nicolas@sign2pay.com'>let us know</a>!
</aside></p>

      </div>
      <div class="dark-box">
        <div id="lang-selector">
          
        </div>
      </div>
    </div>
  </body>
</html>